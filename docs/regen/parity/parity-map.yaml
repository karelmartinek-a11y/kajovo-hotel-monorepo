version: 1
updated_at: "2026-02-22"
notes:
  - "Deterministická parity mapa: modul -> požadované chování -> evidence -> stav -> cílové umístění."
  - "Status enum: MISSING | IN_PROGRESS | DONE | BLOCKED | DROPPED"

modules:
  - module: dashboard
    required_behavior: "Přehledová route a navigační vstup dle IA"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/web/routes.py:/admin/dashboard"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: modules.dashboard"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: route '/'"

  - module: breakfast
    required_behavior: "CRUD + denní souhrn snídaní v UI/API"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/api/breakfast.py"
        - "legacy/hotel-backend/app/web/routes_admin.py:/admin/breakfast*"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: /snidane*"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: /snidane*"
      - "apps/kajovo-hotel-api/app/api/routes/breakfast.py"

  - module: lost_found
    required_behavior: "Evidence ztrát a nálezů (list/detail/create/edit/delete)"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/web/routes.py:/admin/reports/findings"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: /ztraty-a-nalezy*"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: /ztraty-a-nalezy*"
      - "apps/kajovo-hotel-api/app/api/routes/lost_found.py"

  - module: issues
    required_behavior: "Evidence závad (list/detail/create/edit/delete)"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/web/routes.py:/admin/reports/issues"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: /zavady*"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: /zavady*"
      - "apps/kajovo-hotel-api/app/api/routes/issues.py"

  - module: inventory
    required_behavior: "Sklad + pohyby + audit"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/web/routes_inventory.py"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: /sklad*"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: /sklad*"
      - "apps/kajovo-hotel-api/app/api/routes/inventory.py"

  - module: reports
    required_behavior: "Hlášení (list/detail/create/edit/delete)"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/api/reports.py"
        - "legacy/hotel-backend/app/web/routes.py:/admin/reports*"
      docs:
        - "apps/kajovo-hotel/ux/ia.json: /hlaseni*"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx: /hlaseni*"
      - "apps/kajovo-hotel-api/app/api/routes/reports.py"

  - module: admin_portal_split
    required_behavior: "Striktní oddělení Admin UI a Portal UI (separate login + separate app/entry)"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/web/routes.py: /admin/login, /login, /portal"
      docs:
        - "brand/panel/login_admin.png"
        - "brand/panel/login_user_fail.png"
    status: MISSING
    target_location:
      - "apps/kajovo-hotel-web/src/admin/*"
      - "apps/kajovo-hotel-web/src/portal/*"

  - module: user_management_only_auth
    required_behavior: "Jediná autorizace přes správu uživatelů v Admin menu; email=username"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/db/models.py: PortalUser"
      docs:
        - "docs/test-accounts.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/app/security/rbac.py"
      - "apps/kajovo-hotel-web/src/rbac.ts"
    links:
      - "this-pr"
      - "this-pr-05-admin-users"
      - "this-pr-fix-commit-pr"

  - module: device
    required_behavior: "Device provisioning/pairing/challenge/verify + Entity ID flow"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/api/device.py"
      docs:
        - "docs/legacy-inventory.md"
    status: DROPPED
    decision: "Device modul: DROPPED"
    target_location:
      - "N/A"
    verification:
      - "No /device/* routes in apps/kajovo-hotel-api/app/api/routes/*.py"
      - "No Device entity in apps/kajovo-hotel-api/app/db/models.py"
      - "No device provisioning route in apps/kajovo-hotel-web/src/main.tsx"

  - module: entity_id_flow
    required_behavior: "Entity ID auth/provisioning flow"
    evidence:
      legacy:
        - "legacy/hotel-backend/app/api/device.py"
    status: DROPPED
    decision: "Entity ID flow is not allowed in target architecture"
    target_location:
      - "N/A"

  - module: api_packaging
    required_behavior: "Editable install pro apps/kajovo-hotel-api funguje v CI bez setuptools discovery chyby"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-api/pyproject.toml"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/pyproject.toml"
    links:
      - "this-pr"
      - "this-pr-fix-signage-tests"
      - "this-pr-fix2"
      - "this-pr-fix3"
      - "this-pr-followup"

  - module: web_e2e_browser_bootstrap
    required_behavior: "Web test job vždy zajistí dostupný Playwright Chromium před spuštěním testů"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-web/package.json"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/package.json:scripts.pretest"
    links:
      - "this-pr"

  - module: web_visual_snapshot_project_scope
    required_behavior: "Visual snapshot testy nepárují viewport varianty napříč phone/tablet/desktop projekty"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-web/tests/visual.spec.ts"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/tests/visual.spec.ts"
    links:
      - "this-pr"

  - module: web_visual_suite_gating
    required_behavior: "Default playwright test běh nepadá na visual snapshot baseline mismatch; visual suite je explicitně opt-in"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-web/tests/visual.spec.ts"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/tests/visual.spec.ts"
    links:
      - "this-pr"

  - module: web_test_command_split
    required_behavior: "Default web test command je stabilní (core gates), visual suite běží separátně"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-web/package.json"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/package.json:scripts.test"
      - "apps/kajovo-hotel-web/package.json:scripts.test:visual"
    links:
      - "this-pr"

  - module: web_playwright_browser_parity
    required_behavior: "Playwright projekty používají browser engine dostupný v CI install kroku"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "apps/kajovo-hotel-web/playwright.config.ts"
        - ".github/workflows/ci-full.yml"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/playwright.config.ts:projects.tablet"
    links:
      - "this-pr"


  - module: api_test_csrf_session_setup
    required_behavior: "API test setup používá validní session + CSRF token pro write requesty a stabilní uvicorn bootstrap"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/07-api-test-csrf-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"
      - "apps/kajovo-hotel-api/tests/test_breakfast.py"
      - "apps/kajovo-hotel-api/tests/test_health.py"
      - "apps/kajovo-hotel-api/tests/test_inventory.py"
      - "apps/kajovo-hotel-api/tests/test_issues.py"
      - "apps/kajovo-hotel-api/tests/test_lost_found.py"
      - "apps/kajovo-hotel-api/tests/test_reports.py"

  - module: api_python_lint_ci_stability
    required_behavior: "Python API lint gate je zelená (Ruff E/F/I), včetně CSRF middleware formátování"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/08-api-lint-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/app/security/auth.py"
      - "apps/kajovo-hotel-api/app/api/routes/auth.py"
      - "apps/kajovo-hotel-api/app/api/routes/users.py"
      - "apps/kajovo-hotel-api/alembic/versions/0009_create_portal_users_table.py"

  - module: api_test_sqlite_db_path_stability
    required_behavior: "API test SQLite DB běží na existující zapisovatelné cestě v lokálu i CI"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/09-sqlite-db-path-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"
      - "apps/kajovo-hotel-api/tests/test_health.py"
      - "apps/kajovo-hotel-api/tests/test_rbac.py"
      - "apps/kajovo-hotel-api/tests/test_users.py"
      - ".github/workflows/ci-full.yml"

  - module: api_test_sqlite_ci_data_dir_alignment
    required_behavior: "CI i pytest fixture používají shodný SQLite data adresář apps/kajovo-hotel-api/data"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/10-sqlite-ci-data-dir-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"
      - ".github/workflows/ci-full.yml"

  - module: api_test_workspace_path_portability
    required_behavior: "API test DB path není hardcoded na /workspace a funguje v GitHub Actions i lokálně"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/11-workspace-path-portability-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"

  - module: api_test_db_tmpdir_isolation
    required_behavior: "API test SQLite DB běží v pytest tmpdir (write-safe, bez host-specific /workspace závislosti)"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/12-api-test-tmpdir-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"

  - module: api_test_uvicorn_cwd_stability
    required_behavior: "API test fixture spouští uvicorn s cwd nezávislým na aktuálním pracovním adresáři"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/13-uvicorn-cwd-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/tests/conftest.py"

  - module: contract_generated_client_sync
    required_behavior: "OpenAPI export a generated shared client jsou synchronní po API změnách (včetně user password endpointů)"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/14-contract-sync-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/openapi.json"
      - "packages/shared/src/generated/client.ts"

  - module: web_nav_initial_media_state_stability
    required_behavior: "Navigace má deterministický initial phone/tablet state bez prvního desktop renderu na tablet viewportu"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/15-nav-tablet-initial-state-fix/verification.md"
    status: DONE
    target_location:
      - "packages/ui/src/navigation/ModuleNavigation.tsx"

  - module: policy_entity_id_rename_guard
    required_behavior: "Policy sentinel nehlásí zakázaný Entity ID naming v API schemas/models ani generated client"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/15-policy-entityid-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-api/app/api/schemas.py"
      - "apps/kajovo-hotel-api/app/db/models.py"
      - "apps/kajovo-hotel-api/app/api/routes/inventory.py"
      - "packages/shared/src/generated/client.ts"

  - module: web_view_states_auth_fallback_permissions
    required_behavior: "View-states smoke route nezkončí na AccessDenied při neúspěšném /api/auth/me; read fallback je deterministický"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/15-view-states-auth-fallback-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/rbac.ts"

  - module: web_view_states_auth_catch_fallback
    required_behavior: "AppRoutes auth bootstrap catch používá read fallback permissions místo prázdné sady"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/15-view-states-auth-catch-fix/verification.md"
    status: DONE
    target_location:
      - "apps/kajovo-hotel-web/src/main.tsx"
      - "apps/kajovo-hotel-web/src/rbac.ts"

  - module: delivery_tracker
    required_behavior: "Jednoznačný SSOT tracker pro ORF prompty 00–15 včetně mapování fix větví"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/progress.md"
        - "docs/regen/00-orf-normalization/verification.md"
    status: DONE
    target_location:
      - "docs/regen/progress.md"
      - "docs/regen/parity/parity-map.yaml"


  - module: repo_guardrails_and_ci_policy
    required_behavior: "CI failne při porušení zákazů /device/*, Entity ID, sdílení Admin/Portal page-view a při chybějícím docs/regen/<NN>-<slug>/verification.md v PR"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/01-guardrails/verification.md"
        - ".github/workflows/ci-gates.yml"
    status: DONE
    target_location:
      - "apps/kajovo-hotel/ci/policy-sentinel.mjs"
      - "apps/kajovo-hotel/ci/check-pr-verification-doc.mjs"
      - ".github/workflows/ci-gates.yml"
    links:
      - "this-pr"


  - module: design_foundation_tokens_signage_panel
    required_behavior: "Jednotné tokeny (Portal/Admin), signace dle manifestu a panel layout mechanismus"
    evidence:
      legacy:
        - "N/A"
      docs:
        - "docs/regen/02-design-foundation/token-map.md"
        - "docs/regen/02-design-foundation/verification.md"
    status: DONE
    target_location:
      - "packages/ui/src/tokens.css"
      - "packages/ui/src/shell/KajovoSign.tsx"
      - "packages/ui/src/shell/AppShell.tsx"
      - "apps/kajovo-hotel-web/tests/signage-routes.spec.ts"
    links:
      - "this-pr"
